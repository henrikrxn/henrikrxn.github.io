---
Title: "WebAssembly 'Hello World' on .NET 8"
Published: "2023-05-27"
---
A word of warning: I am a noob at WebAssembly, WASI and WASM, so some of the
stuff in this post is probably superfluous, maybe even wrong. I could not yet
find much information online, so I have just been trying stuff.

I mostly wrote the post for my own sake to have everything written down so I
have a reference when I get the time to pick this up again.

## Going forward

I'll either update this post as I find out more or make a follow-up post.

I'll also try to keep this post updated as more .NET 8 previews are released.

My longer term goal is to play with WebAssembly interoperability between
different languages outside of the browser.

You can find the source code for this post [here](https://github.com/henrikrxn/webassembly-experiments/tree/main/wasiconsole-hello-world).
The initial commit is the code as generated by `dotnet new` and I since made
modifications to the README.md to correct the things I could not get to work.

## Scenario for this post: Hello World

The scenario I want to try is to:

1. Build a WASI compatible .wasm file using .NET 8 and whatever that may need,
e.g. .NET WASI SDK.
2. Use [Wasmtime CLI](https://github.com/BytecodeAlliance/wasmtime) to run that file.
Amongst other things the Wasmtime CLI is a standalone WebAssembly runtime.

## What I found about WASI in .NET 8

* Github [issue](https://github.com/dotnet/runtime/issues/65895) tracking WASI
support in .NET 8.
* Github [issue](https://github.com/dotnet/runtime/issues/82788) tracking
publishing a Nuget package for WASI SDK based on the
[dotnet/runtime](https://github.com/dotnet/runtime/) Github repository.

There is also a [dotnet/dotnet-wasi-sdk](https://github.com/dotnet/dotnet-wasi-sdk/)
Github repository, but it looks like this has been abandoned because of the
ongoing work in dotnet/runtime. Steve Sanderson also has an even older version
[SteveSandersonMS/dotnet-wasi-sdk](https://github.com/SteveSandersonMS/dotnet-wasi-sdk/)

## What I ended up having installed

My strategy for the 'Hello World' has been to install everything sounding
remotely relevant, because there is precious little information and I did not
want to have to fight strange error messages.

* [.NET 8 Preview 4](https://dotnet.microsoft.com/en-us/download/dotnet/8.0)
* Visual Studio Community 2022 Preview 17.7.0 Preview 1
* A number of .NET workloads for WebAssembly
* Wasmtime CLI 9.0.2

See details on what and how at the end of the article.

## Making the 'Hello World' program

I used a Powershell 7 prompt:

* `PS> mkdir wasiconsole-hello-world`
* `PS> cd wasiconsole-hello-world`
* `PS> dotnet new wasiconsole`
* `PS> dotnet build -c Debug`
* `PS> dotnet run -c Debug`

Or if you want to use wasmtime directly:

* `PS> cd .\bin\Debug\net8.0\wasi-wasm\AppBundle\`
* `PS> wasmtime .\dotnet.wasm --dir . wasiconsole-hello-world`

The option `--dir .`enables `wasmtime` to read the files it needs to read.
My guess the need for this might go away in a later preview, but time will tell.

This is different from what's written in the generated README.md, but even after
correcting the obvious mistake in the path I could not get the instructions in
the generated README.md to work, so I did this instead.

## Sidebar: Installed software

### .NET SDK

I already had [.NET 8 Preview 4](https://dotnet.microsoft.com/en-us/download/dotnet/8.0)
installed.

### Visual Studio

I already had Visual Studio Community 2022 Preview 17.7.0 Preview 1 with these
relevant "individual components" installed:

* .NET 6.0 WebAssembly Build Tools
* .NET 7.0 WebAssembly Build Tools
* .NET WebAssembly Build Tools

I ended up using the dotnet CLI, but I have no idea if the Visual
Studio components contributed in any way.

### .NET workloads

I ended up having these .NET worksloads installed:

* wasi-experimental
* wasm-experimental
* wasm-tools-net7
* wasm-tools-net6 (came from Visual Studio)
* wasm-tools (came from Visual Studio)

I had previously not used workloads and could not find much online except the
dotnet CLI reference, so these commands helped me:

NB: The `dotnet workload` commands are influenced by `global.json` files, so
remember to check that your targeting .NET 8 with `dotnet --info`.

* `dotnet workload list`
  Lists the workloads you have installed for the SDK currently in scope.
* `dotnet workload search`
  Finds all available workloads, but there are not that many yet, so that is OK.
* `dotnet workload install <workload id>`

### Wasmtime CLI

Installed Wasmtime CLI [9.0.2](https://github.com/bytecodealliance/wasmtime/releases/tag/v9.0.2)

I used the MSI because 9.0.2 is not yeat available thru winget.

#### Minor nuisance with Wasmtime CLI on Windows

When upgrading there are a couple of things to note:

* Upgrading does not correctly uninstall older versions which still show up in
"Control Panel -> Programs and Features" and if you are using Winget it will
keep insisting that there is an upgrade available.
* If you after upgrading to latest uninstall any older versions thru "Control Panel"
then you need to either:
  * Add wasmtime to your path again
  * Winget: Remove and re-install to get the path set-up properly
  * In "Control Panel" choose "Repair" to fix the path

So if you do not want older versions lying around then the best way to ensure
that evrything works:

1. Uninstall the wasmtime you currently have
2. Install the latest version
